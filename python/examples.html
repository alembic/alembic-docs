

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introduction &mdash; Alembic 1.5.7 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Alembic 1.5.7 documentation" href="../index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Alembic
          

          
            
            <img src="../_static/alembic.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.5.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <!-- Local TOC -->
                <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Introduction</a><ul>
<li><a class="reference internal" href="#major-concepts">Major Concepts</a></li>
<li><a class="reference internal" href="#importing">Importing</a></li>
<li><a class="reference internal" href="#namespaces">Namespaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-getting-data">Setting &amp; Getting Data</a><ul>
<li><a class="reference internal" href="#archives">Archives</a></li>
<li><a class="reference internal" href="#objects">Objects</a></li>
<li><a class="reference internal" href="#properties">Properties</a></li>
<li><a class="reference internal" href="#samples">Samples</a><ul>
<li><a class="reference internal" href="#time-sampling">Time Sampling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reading-an-archive">Reading an Archive</a></li>
<li><a class="reference internal" href="#hierarchy-navigation">Hierarchy Navigation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#finding-a-mesh-by-name">Finding a Mesh By Name</a></li>
<li><a class="reference internal" href="#accumulating-a-transform">Accumulating a Transform</a></li>
<li><a class="reference internal" href="#write-non-standard-data-for-a-polymesh">Write Non-Standard Data for a PolyMesh</a></li>
<li><a class="reference internal" href="#python-module-index">Python Module Index</a></li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Alembic</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Introduction</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/python/examples.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="introduction">
<span id="pyalembic-intro"></span><h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>The Alembic system is intended to facilitate baked (cached) geometry workflows and
platform-independent geometry interchange and sharing. It accomplishes this by being,
at its core, a library for efficiently storing samples of hierarchically related typed
data. Layered on top of that is a system for interpreting that data as geometry or geometric
transforms, but it’s important to keep in mind the primacy of data management at its center.</p>
<div class="section" id="major-concepts">
<h2>Major Concepts<a class="headerlink" href="#major-concepts" title="Permalink to this headline">¶</a></h2>
<p>Alembic has a completely separate but parallel class hierarchy for input and output. This
maintains the important abstraction that Alembic is for storage, representation, and archival
as opposed to being a dynamic scene manipulation framework.</p>
<p>An alembic Archive consists of multiple Objects, which may or may not have Properties, in a
hierarchical parent/child tree that forms an acyclic directed graph. Data are written as Samples
at specific times, and are read back similarly. Interpolation between these samples is not the
function of Alembic and, if required, must be done by the plug-in that uses Alembic. However,
Alembic provides a rich interface for retrieving multiple Samples based on time through the
TimeSampling class, defined in AbcCoreAbstract. Using that, client code may get all the required
data for whatever interpolation is desired.</p>
</div>
<div class="section" id="importing">
<h2>Importing<a class="headerlink" href="#importing" title="Permalink to this headline">¶</a></h2>
<p>Importing Alembic is simply:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">alembic</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure that PyImath is in your PYTHONPATH, and Boost::Python in LD_LIBRARY_PATH.</p>
</div>
</div>
<div class="section" id="namespaces">
<h2>Namespaces<a class="headerlink" href="#namespaces" title="Permalink to this headline">¶</a></h2>
<p>Alembic itself is composed of several layers of libraries, each of which builds extensively
on the layer below it. The lowest level library is an abstract interface layer called
<a class="reference internal" href="abca.html#module-alembic.AbcCoreAbstract" title="alembic.AbcCoreAbstract"><code class="xref py py-mod docutils literal"><span class="pre">AbcCoreAbstract</span></code></a> which all the other user-facing layers are built.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="modindex.html">Alembic Module Index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="abc.html"><code class="docutils literal"><span class="pre">alembic.Abc</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="abca.html"><code class="docutils literal"><span class="pre">alembic.AbcCoreAbstract</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="abcc.html"><code class="docutils literal"><span class="pre">alembic.AbcCollection</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="abcg.html"><code class="docutils literal"><span class="pre">alembic.AbcGeom</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="abcm.html"><code class="docutils literal"><span class="pre">alembic.AbcMaterial</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="util.html"><code class="docutils literal"><span class="pre">alembic.Util</span></code></a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="setting-getting-data">
<h1>Setting &amp; Getting Data<a class="headerlink" href="#setting-getting-data" title="Permalink to this headline">¶</a></h1>
<p>We&#8217;ll start by targeting the thing you&#8217;d most often want to do - write and read
animated, geometric primitives. To do this, we will be using two main
modules: <a class="reference internal" href="abc.html"><span class="doc">alembic.Abc</span></a>, which provides the basic Alembic Abstractions,
and <a class="reference internal" href="abcg.html"><span class="doc">alembic.AbcGeom</span></a>, which implements specific Geometric primitives
on top of alembic.Abc (this example is taken from <code class="docutils literal"><span class="pre">python/PyAlembic/Tests/testPolyMesh.py</span></code>).</p>
<div class="section" id="archives">
<h2>Archives<a class="headerlink" href="#archives" title="Permalink to this headline">¶</a></h2>
<p>An <em>Archive</em> is Alembic&#8217;s term for the actual file on disk and is the top-level container
with all of the scene data. Archives contain Objects.</p>
<p>Our sample output Archive will contain a single animated Transform with a single static PolyMesh
as its child. Because we&#8217;re creating an <a class="reference internal" href="abc.html#alembic.Abc.OArchive" title="alembic.Abc.OArchive"><code class="xref py py-class docutils literal"><span class="pre">OArchive</span></code></a>, this will create (or clobber)
the archive file with this filename:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">oarch</span> <span class="o">=</span> <span class="n">OArchive</span><span class="p">(</span><span class="s1">&#39;polyMesh1.abc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="objects">
<h2>Objects<a class="headerlink" href="#objects" title="Permalink to this headline">¶</a></h2>
<p>An Alembic Object is the main unit of hierarchy in Alembic. You can think of an Alembic Archive
as a typical UNIX-style filesystem (eg, ext2fs), and of Alembic Objects as directories in that
filesystem. The analogy is not perfect, as will be seen shortly, but it’s not bad. Objects don’t
contain data directly, but instead provide structure for filling with more directly-data-containing
entities. Alembic Objects are the primary unit of encapsulation. Objects contain Properties.</p>
<p>A Schema is a minimal set of expected properties which implement some complex Object, such as a PolyMesh.
In the simplest, standard case, there will be a compound property at the top with a certain name, and
inside the compound property will be some number of additional properties that implement the Object.
In the case of a PolyMesh, these properties would include a list of vertices (a V3fArray), a list of
indices (an IntArray), and a list of &#8220;per-face counts&#8221; (more on this later).</p>
<p><strong>Create a PolyMesh class object</strong></p>
<p>An <a class="reference internal" href="abcg.html#alembic.AbcGeom.OPolyMesh" title="alembic.AbcGeom.OPolyMesh"><code class="xref py py-class docutils literal"><span class="pre">OPolyMesh</span></code></a> is-an OObject that has-an
<a class="reference internal" href="abcg.html#alembic.AbcGeom.OPolyMeshSchema" title="alembic.AbcGeom.OPolyMeshSchema"><code class="xref py py-class docutils literal"><span class="pre">OPolyMeshSchema</span></code></a>. An OPolyMeshSchema is-an <a class="reference internal" href="abc.html#alembic.Abc.OCompoundProperty" title="alembic.Abc.OCompoundProperty"><code class="xref py py-class docutils literal"><span class="pre">OCompoundProperty</span></code></a>. In this case,
we&#8217;re parenting the PolyMesh under the Archive&#8217;s top node and naming it &#8220;meshy&#8221;.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meshObj</span> <span class="o">=</span> <span class="n">OPolyMesh</span><span class="p">(</span><span class="n">oarch</span><span class="o">.</span><span class="n">getTop</span><span class="p">(),</span> <span class="s2">&quot;meshy&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mesh</span> <span class="o">=</span> <span class="n">meshyObj</span><span class="o">.</span><span class="n">getSchema</span><span class="p">()</span>
</pre></div>
</div>
<p>Remember that an IPolyMesh is an IObject, and an IPolyMeshSchema <em>is an</em> ICompoundProperty (and an IPolyMesh
<em>has an</em> IPolyMeshSchema). So, just like any other Object in Alembic, it can be constructed with its parent
Object and its name. Every Object in Alembic is the child of some other Object, EXCEPT for the TopObject,
which is the lone direct child of the Archive.</p>
</div>
<div class="section" id="properties">
<h2>Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<p>Data in Alembic is stored in Samples, which are then stored in Properties.</p>
<p>There are two types of Alembic properties, Simple and Compound. A CompoundProperty is used to hold properties.
It is the main type of container you’ll be working with. Simple Properties hold samples and can be either
Scalar or Array. These samples are what actually holds your data.</p>
<p>The major semantic difference between scalar and array properties is that to say that a Property is Scalar
is to say, &#8220;There is one single value per Sample for this Property&#8221;. Because of this, it is meaningless to
talk about a Scalar Property changing topology (eg, mass will be one floating point value; it won&#8217;t sometimes
be two floating point values); array properties have no such restriction. Furthermore, array properties are
cached and indexed in such a way that repeatedly storing identical samples will not store multiple copies of
the data. Scalar properties do not cache in this way.</p>
<p><strong>Scalar Properties</strong></p>
<p>An Alembic ScalarProperty is a Simple Property that contains Samples whose type and number of elements
(the extent) is fixed and known prior to writing. Examples of ScalarProperties are FloatProperty (each Sample
is a 32-bit floating point number; extent = 1), StringProperty (each sample is a single string, of whatever
size; extent = 1), or an M44dProperty (each Sample is sixteen 64-bit floating point numbers; extent = 16).
The maximum extent for a ScalarProperty is 256.</p>
<p>Examples of ScalarProperties:</p>
<blockquote>
<div><ul class="simple">
<li>The mass of a rigid body (extent=1, a single numerical value)</li>
<li>A color (for an RGB vector, extent=3, three floating point values)</li>
<li>A bounding box (extent=6, two three-vectors of floating point values)</li>
</ul>
</div></blockquote>
<p><strong>Array Properties</strong></p>
<p>An Alembic ArrayProperty is a Simple Property that contains Samples whose type is fixed and known prior to
writing, but whose extent is variable. Examples of ArrayProperties are DoubleArrayProperty (each Sample is
an array of varying length, each array element being a single 64-bit floating point number), V3fArrayProperty
(each Sample is an array of varying length, and each element in the array being an Imath::Vec3f, which is
three 32-bit floating point numbers), or M44fArrayProperty (each Sample is an array of varying length, and each
array element is an Imath::M44f, or sixteen 32-bit floating point numbers).</p>
<p>Examples of Array Properties:</p>
<blockquote>
<div><ul class="simple">
<li>A list of the vertices of a polygonal mesh</li>
<li>A list of particles in a fluid simulation</li>
</ul>
</div></blockquote>
<p><strong>Compound Properties</strong></p>
<p>Compound properties are a special type of property in that they are not properties per se but rather containers
for other properties (compound properties included). If an object has any properties, it must have a compound
property which contains all other properties.</p>
</div>
<div class="section" id="samples">
<h2>Samples<a class="headerlink" href="#samples" title="Permalink to this headline">¶</a></h2>
<p>An Alembic Sample is the container that composes raw data and a time into a single entity. As with Properties,
Samples are either Scalar or Array.</p>
<p>UVs and Normals use GeomParams, which can be written or read as indexed or not, as you&#8217;d like.
The typed GeomParams have an inner Sample class that is used for setting and getting data. GeomParams are typed
according to the type of data they will contain, for example the <a class="reference internal" href="abcg.html#alembic.AbcGeom.OV2fGeomParamSample" title="alembic.AbcGeom.OV2fGeomParamSample"><code class="xref py py-class docutils literal"><span class="pre">OV2fGeomParamSample</span></code></a> is
used to store V2f data, such as UVs. Continuing our example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">uvsamp</span> <span class="o">=</span> <span class="n">OV2fGeomParamSample</span><span class="p">(</span><span class="n">uvs</span><span class="p">,</span> <span class="n">kFacevaryingScope</span><span class="p">)</span>
</pre></div>
</div>
<p>Normals have their own type.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">nsamp</span>  <span class="o">=</span> <span class="n">ON3fGeomParamSample</span><span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="n">kFacevaryingScope</span><span class="p">)</span>
</pre></div>
</div>
<p>Create a <a class="reference internal" href="abcg.html#alembic.AbcGeom.OPolyMeshSchemaSample" title="alembic.AbcGeom.OPolyMeshSchemaSample"><code class="xref py py-class docutils literal"><span class="pre">OPolyMeshSchemaSample</span></code></a> Sample. We&#8217;re creating the Sample inline here, but we could
create a static sample and leave it around, only modifying the parts that have changed. The first sample
should contain at least all of the required data for a PolyMesh.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mesh_samp</span> <span class="o">=</span> <span class="n">OPolyMeshSchemaSample</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">uvsamp</span><span class="p">,</span> <span class="n">nsamp</span><span class="p">)</span>
</pre></div>
</div>
<p>Make up some bounding box data and set it on the sample.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cbox</span> <span class="o">=</span> <span class="n">imath</span><span class="o">.</span><span class="n">Box3d</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cbox</span><span class="o">.</span><span class="n">extendBy</span><span class="p">(</span><span class="n">imath</span><span class="o">.</span><span class="n">V3d</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cbox</span><span class="o">.</span><span class="n">extendBy</span><span class="p">(</span><span class="n">imath</span><span class="o">.</span><span class="n">V3d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mesh_samp</span><span class="o">.</span><span class="n">setChildBounds</span><span class="p">(</span><span class="n">cbox</span><span class="p">)</span>
</pre></div>
</div>
<p>Set the sample twice. Because the data is the same in both samples, Alembic will store only one copy,
but note that two samples have been set.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mesh</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">mesh_samp</span><span class="p">);</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mesh</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">mesh_samp</span><span class="p">);</span>
</pre></div>
</div>
<p>Alembic objects close themselves automatically when they go out of scope, so - we don&#8217;t have to do
anything to write them to disk.</p>
<div class="section" id="time-sampling">
<h3>Time Sampling<a class="headerlink" href="#time-sampling" title="Permalink to this headline">¶</a></h3>
<p>Alembic files consist of a series of Samples of Properties at different times. Every property, therefore,
has a notion of when it has been &#8216;sampled&#8217; (both during write and during read). There are four types of
time sampling that Alembic supports:</p>
<p><strong>Uniform</strong></p>
<p>One Sample per dt where the dt is defined during construction. This is probably the most common
time sampling type; specifically properties that are sampled every 24th of a second.</p>
<p><strong>Identity</strong></p>
<p>Identity time sampling is the default, and is merely a special case of uniform sampling where
for each sample, i, the time of that sample is i.</p>
<p><strong>Cyclic</strong></p>
<p>Some finite number of Samples per dt; for example, shutter open and shutter close.</p>
<p><strong>Acyclic</strong></p>
<p>Sample times are arbitrary and follow no particular cycle. This is the least common case and will
cause the most amount of data to be stored in the Alembic file (explicit values for each sample
time must be stored, for every acyclic property).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All Samples must be written in strictly increasing temporal order.</p>
</div>
</div>
</div>
<div class="section" id="reading-an-archive">
<h2>Reading an Archive<a class="headerlink" href="#reading-an-archive" title="Permalink to this headline">¶</a></h2>
<p>Read an Alembic archive, also referred to as an <a class="reference internal" href="abc.html#alembic.Abc.IArchive" title="alembic.Abc.IArchive"><code class="xref py py-class docutils literal"><span class="pre">IArchive</span></code></a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">iarch</span> <span class="o">=</span> <span class="n">IArchive</span><span class="p">(</span><span class="s1">&#39;polyMesh1.abc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="s2">&quot;Reading&quot;</span><span class="p">,</span> <span class="n">iarch</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
<span class="go">Reading polyMesh1.abc</span>
</pre></div>
</div>
</div>
<div class="section" id="hierarchy-navigation">
<h2>Hierarchy Navigation<a class="headerlink" href="#hierarchy-navigation" title="Permalink to this headline">¶</a></h2>
<p>Because of its intention to store Samples of scene graphs, Alembic has a notion of parent/child hierarchy.
At the apex of this hierarchy is the Archive, which can be treated as an Object. Beneath this top-level
Archive can be many child Objects, each of which can be the parent to any number of other Objects, and so on.
Ancestry is acyclic &#8211; a descendant of an object cannot be the ancestor of that same object.</p>
<p>As mentioned above, If an object contains any Properties, it contains them within a top-level Compound Property.
A Compound Property can have any number of child properties of any time (scalar, array or compound). Again,
this relationship is acyclic.</p>
<p>Usually, we want to start by getting the top node of the scene hierarchy, which will always be
called <em>ABC</em>. So, in our example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">top</span> <span class="o">=</span> <span class="n">iarch</span><span class="o">.</span><span class="n">getTop</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
<span class="go">&#39;ABC&#39;</span>
</pre></div>
</div>
<p>All scene data is parented under this top node.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meshObj</span> <span class="o">=</span> <span class="n">IPolyMesh</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="s2">&quot;meshy&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mesh</span> <span class="o">=</span> <span class="n">meshObj</span><span class="o">.</span><span class="n">getSchema</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">getNormalsParam</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uv</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">getUVsParam</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p>If you don&#8217;t know the object type of the input data, you can check the Object MetaData
and match it to a specific type.</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">IPolyMeshSchema</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span> <span class="n">meshObj</span> <span class="o">=</span> <span class="n">IPolyMesh</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">KWrapExisting</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal"><span class="pre">N</span></code> and <code class="docutils literal"><span class="pre">uv</span></code> are GeomParams, which can be stored as indexed or not.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="ow">not</span> <span class="n">N</span><span class="o">.</span><span class="n">isIndexed</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="ow">not</span> <span class="n">uv</span><span class="o">.</span><span class="n">isIndexed</span><span class="p">()</span>
</pre></div>
</div>
<p>Get the Samples.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meshSamp</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
</pre></div>
</div>
<p>Check the self bounding box.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">meshSamp</span><span class="o">.</span><span class="n">getSelfBounds</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">==</span> <span class="n">imath</span><span class="o">.</span><span class="n">V3d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">meshSamp</span><span class="o">.</span><span class="n">getSelfBounds</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="n">imath</span><span class="o">.</span><span class="n">V3d</span><span class="p">(</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="mf">1.0</span><span class="p">,</span>  <span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
<p>&#8220;ArbGeomParams&#8221; are a container that should only contain GeomParams. We didn&#8217;t set
any on write, so on read, it should be an invalid container. Invalid Properties of
any type evaluate as boolean False; valid Properties, even if they are empty, will
evaluate as True.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">arbattrs</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">getArbGeomParams</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="ow">not</span> <span class="n">arbattrs</span>
</pre></div>
</div>
<p><code class="xref py py-func docutils literal"><span class="pre">getExpandedValue()</span></code> takes an optional ISampleSelector, and returns an typed
<code class="xref py py-class docutils literal"><span class="pre">IGeomParamSample</span></code>.  <code class="xref py py-func docutils literal"><span class="pre">IGeomParamSample.getVals()</span></code> returns an
TypedArraySamplePtr.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">nsp</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">getExpandedValue</span><span class="p">()</span><span class="o">.</span><span class="n">getVals</span><span class="p">()</span>
</pre></div>
</div>
<p>GeomParams and Properties have a method, <code class="xref py py-func docutils literal"><span class="pre">isConstant()</span></code>, that returns if there are fewer than
two unique samples in them.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">N</span><span class="o">.</span><span class="n">isConstant</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">rv</span><span class="o">.</span><span class="n">isConstant</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">nsp</span> <span class="p">)</span> <span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">assert</span> <span class="n">nsp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">normals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">uvsamp</span> <span class="o">=</span> <span class="n">uv</span><span class="o">.</span><span class="n">getIndexedValue</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">uvsamp</span><span class="o">.</span><span class="n">getIndices</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uv2</span> <span class="o">=</span> <span class="n">uvsamp</span><span class="o">.</span><span class="n">getVals</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">uv2</span> <span class="o">==</span> <span class="n">V2f</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">positions</span> <span class="o">=</span> <span class="n">meshSamp</span><span class="o">.</span><span class="n">getPositions</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">assert</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">verts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="finding-a-mesh-by-name">
<h1>Finding a Mesh By Name<a class="headerlink" href="#finding-a-mesh-by-name" title="Permalink to this headline">¶</a></h1>
<p>In this example, we&#8217;ll crawl through an IArchive, and find a mesh by a particular name. This example is
adapted from the previous example and we&#8217;re only bothering to match against the
<a class="reference internal" href="abcg.html#alembic.AbcGeom.IPolyMesh" title="alembic.AbcGeom.IPolyMesh"><code class="xref py py-class docutils literal"><span class="pre">IPolyMesh</span></code></a> and <a class="reference internal" href="abcg.html#alembic.AbcGeom.ISubD" title="alembic.AbcGeom.ISubD"><code class="xref py py-class docutils literal"><span class="pre">ISubD</span></code></a> object classes.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">visitObject</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">md</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">getMetaData</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">IPolyMesh</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">md</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ISubD</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">md</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;Found it!&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">getFullName</span><span class="p">()</span>
            <span class="k">return</span>
    <span class="k">for</span> <span class="n">childObject</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
        <span class="n">visitObject</span><span class="p">(</span><span class="n">childObject</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="n">arch</span> <span class="o">=</span> <span class="n">IArchive</span><span class="p">(</span><span class="s2">&quot;octopus.abc&quot;</span><span class="p">)</span>
<span class="n">visitObject</span><span class="p">(</span><span class="n">arch</span><span class="o">.</span><span class="n">getTop</span><span class="p">(),</span> <span class="s2">&quot;octopus_lowShape&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="accumulating-a-transform">
<h1>Accumulating a Transform<a class="headerlink" href="#accumulating-a-transform" title="Permalink to this headline">¶</a></h1>
<p>In this example, given a node in an Alembic Archive, we&#8217;ll figure out what the final xform is. We
proceed from the leaf to the root. We&#8217;re going to change <code class="xref py py-func docutils literal"><span class="pre">visitObject()</span></code> slightly. Instead of checking the object&#8217;s
name, we&#8217;re going to call a new function, <code class="xref py py-func docutils literal"><span class="pre">getBounds()</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">gBounds</span> <span class="o">=</span> <span class="n">imath</span><span class="o">.</span><span class="n">Box3d</span><span class="p">()</span>
<span class="n">gBounds</span><span class="o">.</span><span class="n">makeEmpty</span><span class="p">()</span>
<span class="n">kWrapExisting</span> <span class="o">=</span> <span class="n">alembic</span><span class="o">.</span><span class="n">Abc</span><span class="o">.</span><span class="n">WrapExistingFlag</span><span class="o">.</span><span class="n">kWrapExisting</span>

<span class="k">def</span> <span class="nf">accumXform</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">IXform</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">getHeader</span><span class="p">()):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">IXform</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">kWrapExisting</span><span class="p">)</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">getSchema</span><span class="p">()</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
        <span class="n">xf</span> <span class="o">*=</span> <span class="n">xs</span><span class="o">.</span><span class="n">getMatrix</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">getFinalMatrix</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="n">xf</span> <span class="o">=</span> <span class="n">imath</span><span class="o">.</span><span class="n">M44d</span><span class="p">()</span>
    <span class="n">xf</span><span class="o">.</span><span class="n">makeIdentity</span><span class="p">()</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">getParent</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">parent</span><span class="p">:</span>
        <span class="n">accumXform</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">getParent</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">xf</span>

<span class="k">def</span> <span class="nf">getBounds</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="n">bnds</span> <span class="o">=</span> <span class="n">imath</span><span class="o">.</span><span class="n">Box3d</span><span class="p">()</span>
    <span class="n">bnds</span><span class="o">.</span><span class="n">makeEmpty</span><span class="p">()</span>
    <span class="n">md</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">getMetaData</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">IPolyMesh</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">md</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ISubD</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">md</span><span class="p">):</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">IPolyMesh</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">kWrapExisting</span><span class="p">)</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">getSchema</span><span class="p">()</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span><span class="o">.</span><span class="n">getPositions</span><span class="p">()</span>
        <span class="n">numPoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numPoints</span><span class="p">):</span>
            <span class="n">bnds</span><span class="o">.</span><span class="n">extendBy</span><span class="p">(</span><span class="n">imath</span><span class="o">.</span><span class="n">V3d</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">bnds</span><span class="o">.</span><span class="n">extendBy</span><span class="p">(</span><span class="n">transform</span><span class="p">(</span><span class="n">bnds</span><span class="p">,</span> <span class="n">xf</span><span class="p">))</span>
    <span class="n">gBounds</span><span class="o">.</span><span class="n">extendBy</span><span class="p">(</span><span class="n">bnds</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">visitObject</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="n">md</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">getMetaData</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">IPolyMesh</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">md</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ISubD</span><span class="o">.</span><span class="n">matches</span><span class="p">(</span><span class="n">md</span><span class="p">):</span>
        <span class="n">getBounds</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">childObject</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
        <span class="n">visitObject</span><span class="p">(</span><span class="n">childObject</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="write-non-standard-data-for-a-polymesh">
<h1>Write Non-Standard Data for a PolyMesh<a class="headerlink" href="#write-non-standard-data-for-a-polymesh" title="Permalink to this headline">¶</a></h1>
<p>In this example, we&#8217;ll store some non-standard data in a PolyMesh. This would only be supported by custom
workflows. Here we need an <a class="reference internal" href="abc.html#alembic.Abc.OCompoundProperty" title="alembic.Abc.OCompoundProperty"><code class="xref py py-class docutils literal"><span class="pre">OCompoundProperty</span></code></a> to use as the parent of our user Property.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">archive</span> <span class="o">=</span> <span class="n">OArchive</span><span class="p">(</span><span class="s2">&quot;crazyPolyMesh1.abc&quot;</span><span class="p">)</span>

<span class="n">meshObj</span> <span class="o">=</span> <span class="n">OPolyMesh</span><span class="p">(</span><span class="n">archive</span><span class="o">.</span><span class="n">getTop</span><span class="p">(),</span> <span class="s2">&quot;crazy&quot;</span><span class="p">)</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">meshObj</span><span class="o">.</span><span class="n">getSchema</span><span class="p">()</span>

<span class="n">myCrazyDataContainer</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">getUserProperties</span><span class="p">()</span>
<span class="n">mass</span> <span class="o">=</span> <span class="n">ODoubleProperty</span><span class="p">(</span><span class="n">myCrazyDataContainer</span><span class="p">,</span> <span class="s2">&quot;mass&quot;</span><span class="p">)</span>
<span class="n">mesh_samp</span> <span class="o">=</span> <span class="n">OPolyMeshSchemaSample</span><span class="p">(</span>
        <span class="n">OP3fGeomParamSample</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">numVerts</span><span class="p">),</span>
        <span class="n">OInt32GeomParamSample</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">numIndices</span><span class="p">),</span>
        <span class="n">OInt32GeomParamSample</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">numCounts</span><span class="p">)</span>
    <span class="p">)</span>

<span class="n">mesh</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">mesh_samp</span><span class="p">)</span>
<span class="n">mass</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="python-module-index">
<h1>Python Module Index<a class="headerlink" href="#python-module-index" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="../py-modindex.html"><span class="std std-ref">Python Module Index</span></a>.</p>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012-2016, Sony Pictures Imageworks Inc. and Industrial Light &amp; Magic, a division of Lucasfilm Entertainment Company Ltd..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.5.7',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>